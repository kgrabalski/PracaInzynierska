(function(){function n(){function t(t,i,r,u,f,e,o){var s=this;s.OrderId=ko.observable(t);s.CreateDate=ko.observable(i);s.DeliveryType=ko.observable(r);s.DeliveryAddress=ko.observable(u);s.RestaurantName=ko.observable(f);s.RestaurantId=ko.observable(e);s.OrderAmount=ko.observable(o);s.OrderItems=ko.observableArray();s.ShowDetails=ko.observable(!1);s.ToogleShowItems=function(){var t=s.ShowDetails();t=!t;t==!0&&n.getOrderItems(s);s.ShowDetails(t)};s.RestaurantUrl=ko.computed(function(){return"/Restaurants/Page?restaurantId="+s.RestaurantId()})}function i(n,t,i,r){var u=this;u.DishName=ko.observable(n);u.Quantity=ko.observable(t);u.Price=ko.observable(i);u.Total=ko.observable(r)}var n=this;n.Orders=ko.observableArray();n.Page=0;n.getOrders=function(){$.ajax({url:"/User/Home/GetUserOrders",type:"POST",data:{page:n.Page},success:function(i){var u,r;for(n.Page++,u=0;u<i.length;u++)r=i[u],n.Orders.push(new t(r.OrderId,r.CreateDate,r.DeliveryType,r.DeliveryAddress,r.RestaurantName,r.RestaurantId,r.OrderAmount))}})};n.getOrders();n.getOrderItems=function(n){$.ajax({url:"/User/Home/GetUserOrderItems",type:"POST",data:{orderId:n.OrderId()},success:function(t){var u,r;for(n.OrderItems.removeAll(),u=0;u<t.length;u++)r=t[u],n.OrderItems.push(new i(r.DishName,r.Quantity,r.Price,r.Total))}})}}function t(){function t(n,t,i,r,u,f,e,o){this.Id=n;this.AddressId=t;this.CityId=i;this.City=r;this.StreetId=u;this.Street=f;this.StreetNumber=e;this.FlatNumber=o;this.DisplayText=this.City+", "+this.Street+" "+this.StreetNumber;this.FlatNumber!=""&&(this.DisplayText+="/"+this.FlatNumber)}var n=this;n.OldPassword=ko.observable();n.NewPassword=ko.observable();n.RepeatNewPassword=ko.observable();n.ShowAlert=ko.observable(!1);n.inputChanged=function(){n.NewPassword()!=n.RepeatNewPassword()?n.ShowAlert(!0):n.ShowAlert(!1)};n.NewPassword.subscribe(n.inputChanged);n.RepeatNewPassword.subscribe(n.inputChanged);n.changePasswordModal=function(){$("#changePassword").modal()};n.changePassword=function(){n.ShowAlert()!=!0&&$.ajax({url:"/Account/ChangePassword",type:"POST",dataType:"json",data:{OldPassword:n.OldPassword(),NewPassword:n.NewPassword(),RepeatNewPassword:n.RepeatNewPassword()},success:function(t){t.Result==!0?window.location="/Account/Logout":(n.cleanModal(),$("#changePasswordAlert").show())},error:function(){n.cleanModal();$("#changePasswordAlert").show()}})};n.cleanModal=function(){$("#changePassword").modal("hide");n.OldPassword("");n.NewPassword("");n.RepeatNewPassword("");n.ShowAlert(!1)};n.DeliveryAddresses=ko.observableArray();n.GetDeliveryAddresses=function(){$.ajax({url:"/Home/GetDeliveryAddresses",type:"POST",success:function(i){for(var r,u=0;u<i.length;u++)r=i[u],n.DeliveryAddresses.push(new t(r.Id,r.AddressId,r.CityId,r.City,r.StreetId,r.Street,r.StreetNumber,r.FlatNumber))}})};n.GetDeliveryAddresses();n.RemoveAddress=function(t){$.ajax({url:"/User/Home/DeleteUserDeliveryAddress",type:"POST",data:{deliveryAddressId:t.Id},success:function(i){i==!0&&n.DeliveryAddresses.remove(t)}})};n.selectCity=$("#selectCity").selectize({valueField:"Id",labelField:"Name",sortField:"Name",create:!1,onChange:function(t){n.selectStreet.clearOptions();n.selectNumber.clearOptions();t!=""?n.selectStreet.enable():(n.selectStreet.disable(),n.selectNumber.disable())}})[0].selectize;n.selectCity.load(function(n){$.ajax({url:"/Address/Cities",type:"POST",dataType:"json",success:function(t){n(t)}})});n.selectStreet=$("#selectStreet").selectize({valueField:"Id",labelField:"Name",sortField:"Name",searchField:["Name"],create:!1,load:function(n,t){if(n.length<3)return t();$.ajax({url:"/Address/Streets",data:{cityId:$("#selectCity").val(),query:n},type:"POST",dataType:"json",success:function(n){t(n)}})},onChange:function(t){n.selectNumber.disable();n.selectNumber.clearOptions();n.selectNumber.load(function(i){$.ajax({url:"/Address/StreetNumbers",data:{streetId:t},type:"POST",dataType:"json",success:function(t){n.selectNumber.enable();i(t)}})})}})[0].selectize;n.selectStreet.disable();n.selectNumber=$("#selectNumber").selectize({valueField:"Id",labelField:"Number",sortField:"Number",searchField:["Number"],create:!1})[0].selectize;n.selectNumber.disable();n.cleanAddAddressModal=function(){$("#addAddress").modal("hide");n.selectStreet.clearOptions();n.selectNumber.clearOptions();n.selectNumber.disable();$("#flatNumber").val("")};n.CreateAddressModal=function(){$("#addAddress").modal()};n.CreateAddress=function(){$.ajax({url:"/User/Home/CreateUserDeliveryAddress",type:"POST",data:{addressId:$("#selectNumber").val(),flatNumber:$("#flatNumber").val()},success:function(i){var r,u;for(n.cleanAddAddressModal(),r=0;r<n.DeliveryAddresses().length;r++)if(u=n.DeliveryAddresses()[r],u.Id==i.Id)return;n.DeliveryAddresses.push(new t(i.Id,i.AddressId,i.CityId,i.City,i.StreetId,i.Street,i.StreetNumber,i.FlatNumber))}})}}$(document).ready(function(){ko.applyBindings(new n,document.getElementById("ordersTab"));ko.applyBindings(new t,document.getElementById("infoTab"))})})();
//# sourceMappingURL=UserPanel.min.js.map
