(function(){function n(){var i=new Date,t=i.getDay(),n,r;return t<10&&(t="0"+t),n=i.getMonth()+1,n<10&&(n="0"+n),r=i.getFullYear(),t+"."+n+"."+r}function t(){function i(n,t,i,r){var u=this;u.UserName=ko.observable(n);u.Comment=ko.observable(t);u.Rating=ko.observable(i);u.Date=ko.observable(r);u.IconUrl=ko.observable();switch(i){case 1:case 2:u.IconUrl("/Images/ic_action_bad.png");break;case 3:u.IconUrl("/Images/ic_action_avg.png");break;case 4:case 5:u.IconUrl("/Images/ic_action_good.png")}}function r(n){this.StarStyle=ko.observable(n)}var t=this,u;t.Opinions=ko.observableArray();t.Rating=0;t.Page=0;t.RestaurantId=$("#opinionsTab").attr("data-rid");t.UsersVoted=ko.observable();t.TotalRating=ko.observable();t.RestaurantStars=ko.observableArray();t.Percentage1Star=ko.observable(0);t.Percentage2Star=ko.observable(0);t.Percentage3Star=ko.observable(0);t.Percentage4Star=ko.observable(0);t.Percentage5Star=ko.observable(0);t.RestaurantStars=ko.observableArray();t.NewRating=ko.observable();t.NewComment=ko.observable();t.NewVisible=ko.observable(!0);t.getOpinions1=function(){t.getOpinions(1,!1)};t.getOpinions2=function(){t.getOpinions(2,!1)};t.getOpinions3=function(){t.getOpinions(3,!1)};t.getOpinions4=function(){t.getOpinions(4,!1)};t.getOpinions5=function(){t.getOpinions(5,!1)};t.getOpinionsAll=function(){t.getOpinions(0,!1)};t.getMoreOpinions=function(){t.getOpinions(-1,!0)};t.getOpinions=function(n,r){r||(t.Rating=n,t.Page=0);$.ajax({url:"/Restaurants/GetOpinions",type:"POST",data:{restaurantId:t.RestaurantId,rating:t.Rating,page:t.Page},success:function(n){var f,u;for(t.Page++,r||t.Opinions.removeAll(),f=0;f<n.length;f++)u=n[f],t.Opinions.push(new i(u.UserName,u.Comment,u.Rating,u.Date))}})};t.addOpinion=function(){$.ajax({url:"/Restaurants/AddOpinion",type:"POST",data:{RestaurantId:t.RestaurantId,Rating:t.NewRating(),Comment:t.NewComment()},success:function(){t.NewVisible(!1);t.getRestaurantRating();var r=new i("Ja",t.NewComment(),t.NewRating(),n());t.Opinions.unshift(r)},error:function(){alert("blad");t.NewRating("");t.NewComment("")}})};t.getRestaurantRating=function(){$.ajax({url:"/Restaurants/GetRestaurantRating",type:"POST",data:{restaurantId:t.RestaurantId},success:function(n){var i;for(t.UsersVoted(n.UsersVoted),t.TotalRating(n.TotalRating),t.Percentage1Star(n.Percentage1Star),t.Percentage2Star(n.Percentage2Stars),t.Percentage3Star(n.Percentage3Stars),t.Percentage4Star(n.Percentage4Stars),t.Percentage5Star(n.Percentage5Stars),t.RestaurantStars.removeAll(),i=0;i<n.StarsCount;i++)t.RestaurantStars.push(new r("glyphicon glyphicon-star"));for(i=0;i<5-n.StarsCount;i++)t.RestaurantStars.push(new r("glyphicon glyphicon-star-empty"))}})};t.getRestaurantRating();t.getOpinions(0);u=$(".starrr").starrr();$(".starrr").on("starrr:change",function(n,i){typeof i!="undefined"?t.NewRating(i):t.NewRating(1)})}$(document).ready(function(){var o={zoom:3,center:new google.maps.LatLng(52.238,21.012),mapTypeId:google.maps.MapTypeId.ROADMAP,scrollwheel:!1,streetViewControl:!1,maxZoom:18,minZoom:12,mapTypeControlOptions:{mapTypeIds:[google.maps.MapTypeId.ROADMAP]},noClear:!0},n=new google.maps.Map(document.getElementById("map"),o),u=new google.maps.LatLngBounds,s=$("#map").attr("data-lat"),h=$("#map").attr("data-lon"),c=$("#map").attr("data-address"),f=$("#map").attr("data-title"),e=new google.maps.LatLng(s,h),i=new google.maps.Marker({position:e,map:n,title:f}),r;[].push(i);r=new google.maps.InfoWindow;google.maps.event.addListener(i,"click",function(){var t=' <div class="objectPageInfo">               <h2>'+f+"<\/h2>               <p>"+c+"<\/p>           <\/div>";r.setContent(t);r.open(n,i)});u.extend(e);n.fitBounds(u);ko.applyBindings(new t,document.getElementById("opinionsTab"))})})();
//# sourceMappingURL=RestaurantPage.min.js.map
